<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tetris</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #222;
            color: white;
            font-family: Arial, sans-serif;
        }
        h1 {
            margin-bottom: 20px;
            color: #00ff88;
        }
        .game-container {
            display: flex;
            gap: 20px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(20, 1fr);
            width: 200px;
            height: 400px;
            border: 2px solid #00ff88;
        }
        .cell {
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        .info-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .next-piece {
            width: 80px;
            height: 80px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            border: 2px solid #00ff88;
            padding: 5px;
        }
        .score {
            font-size: 1.2em;
        }
        .controls {
            margin-top: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 1em;
            background-color: #00ff88;
            color: #222;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #00cc66;
        }
        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2em;
            color: #ff0d72;
            text-align: center;
            display: none;
        }
        .piece-I { background-color: #00ffff; }
        .piece-O { background-color: #ffff00; }
        .piece-T { background-color: #ff00ff; }
        .piece-S { background-color: #00ff00; }
        .piece-Z { background-color: #ff0000; }
        .piece-J { background-color: #0000ff; }
        .piece-L { background-color: #ff8800; }
    </style>
</head>
<body>
    <h1>Tetris</h1>
    <div class="game-container">
        <div class="grid" id="grid"></div>
        <div class="info-panel">
            <div class="next-piece" id="nextPiece"></div>
            <div class="score">Score: <span id="score">0</span></div>
            <div class="controls">
                <button id="startButton">Start Game</button>
            </div>
        </div>
    </div>
    <div class="game-over" id="gameOver">
        Game Over!<br>
        <button id="restartButton">Play Again</button>
    </div>
    <script>
        const gridElement = document.getElementById('grid');
        const nextPieceElement = document.getElementById('nextPiece');
        const scoreElement = document.getElementById('score');
        const gameOverElement = document.getElementById('gameOver');
        const startButton = document.getElementById('startButton');
        const restartButton = document.getElementById('restartButton');

        const COLS = 10;
        const ROWS = 20;
        const BLOCK_SIZE = 20;
        const PIECES = {
            I: { shape: [[1,1,1,1]], color: 'piece-I' },
            O: { shape: [[1,1],[1,1]], color: 'piece-O' },
            T: { shape: [[0,1,0],[1,1,1]], color: 'piece-T' },
            S: { shape: [[0,1,1],[1,1,0]], color: 'piece-S' },
            Z: { shape: [[1,1,0],[0,1,1]], color: 'piece-Z' },
            J: { shape: [[1,0,0],[1,1,1]], color: 'piece-J' },
            L: { shape: [[0,0,1],[1,1,1]], color: 'piece-L' }
        };
        const KEYS = {
            LEFT: 'ArrowLeft',
            RIGHT: 'ArrowRight',
            DOWN: 'ArrowDown',
            UP: 'ArrowUp',
            SPACE: ' '
        };

        let grid;
        let currentPiece;
        let nextPiece;
        let score = 0;
        let gameInterval;
        let gameActive = false;
        let dropInterval = 1000;

        function createGrid() {
            gridElement.innerHTML = '';
            grid = Array.from({ length: ROWS }, () => Array(COLS).fill(0));
            
            for (let row = 0; row < ROWS; row++) {
                for (let col = 0; col < COLS; col++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    gridElement.appendChild(cell);
                }
            }
        }

        function draw() {
            gridElement.childNodes.forEach((cell, index) => {
                const row = Math.floor(index / COLS);
                const col = index % COLS;
                const pieceClass = grid[row][col] ? grid[row][col] : '';
                cell.className = `cell ${pieceClass}`;
            });
        }

        function drawNextPiece() {
            nextPieceElement.innerHTML = '';
            const size = 4;
            for (let row = 0; row < size; row++) {
                for (let col = 0; col < size; col++) {
                    const cell = document.createElement('div');
                    const isFilled = nextPiece.shape[row] && nextPiece.shape[row][col];
                    cell.className = `cell ${isFilled ? nextPiece.color : ''}`;
                    nextPieceElement.appendChild(cell);
                }
            }
        }

        function getRandomPiece() {
            const pieces = Object.keys(PIECES);
            return PIECES[pieces[Math.floor(Math.random() * pieces.length)]];
        }

        function spawnPiece() {
            currentPiece = nextPiece || getRandomPiece();
            nextPiece = getRandomPiece();
            drawNextPiece();
            currentPiece.position = { x: 3, y: 0 };
            if (checkCollision()) {
                gameOver();
                return;
            }
            mergePiece();
        }

        function mergePiece() {
            currentPiece.shape.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value) {
                        const gridY = currentPiece.position.y + y;
                        const gridX = currentPiece.position.x + x;
                        grid[gridY][gridX] = currentPiece.color;
                    }
                });
            });
        }

        function clearPiece() {
            currentPiece.shape.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value) {
                        const gridY = currentPiece.position.y + y;
                        const gridX = currentPiece.position.x + x;
                        grid[gridY][gridX] = 0;
                    }
                });
            });
        }

        function movePiece(direction) {
            clearPiece();
            currentPiece.position.x += direction;
            if (checkCollision()) {
                currentPiece.position.x -= direction;
            }
            mergePiece();
            draw();
        }

        function rotatePiece() {
            clearPiece();
            const rotated = [];
            for (let x = 0; x < currentPiece.shape[0].length; x++) {
                const newRow = [];
                for (let y = currentPiece.shape.length - 1; y >= 0; y--) {
                    newRow.push(currentPiece.shape[y][x]);
                }
                rotated.push(newRow);
            }
            const originalShape = currentPiece.shape;
            currentPiece.shape = rotated;
            if (checkCollision()) {
                currentPiece.shape = originalShape;
            }
            mergePiece();
            draw();
        }

        function dropPiece() {
            clearPiece();
            currentPiece.position.y++;
            if (checkCollision()) {
                currentPiece.position.y--;
                mergePiece();
                clearLines();
                spawnPiece();
            }
            mergePiece();
            draw();
        }

        function checkCollision() {
            return currentPiece.shape.some((row, y) => {
                return row.some((value, x) => {
                    const gridY = currentPiece.position.y + y;
                    const gridX = currentPiece.position.x + x;
                    return (
                        value !== 0 &&
                        (gridY >= ROWS ||
                         gridX < 0 ||
                         gridX >= COLS ||
                         (grid[gridY] && grid[gridY][gridX] !== 0))
                    );
                });
            });
        }

        function clearLines() {
            let linesCleared = 0;
            for (let row = ROWS - 1; row >= 0; row--) {
                if (grid[row].every(cell => cell !== 0)) {
                    grid.splice(row, 1);
                    grid.unshift(Array(COLS).fill(0));
                    linesCleared++;
                    row++;
                }
            }
            if (linesCleared > 0) {
                score += linesCleared * 100;
                scoreElement.textContent = score;
                dropInterval = Math.max(100, dropInterval - 20);
                clearInterval(gameInterval);
                gameInterval = setInterval(dropPiece, dropInterval);
            }
        }

        function gameOver() {
            clearInterval(gameInterval);
            gameActive = false;
            gameOverElement.style.display = 'block';
        }

        function startGame() {
            createGrid();
            score = 0;
            scoreElement.textContent = score;
            dropInterval = 1000;
            gameOverElement.style.display = 'none';
            gameActive = true;
            spawnPiece();
            draw();
            gameInterval = setInterval(dropPiece, dropInterval);
        }

        function handleKeyDown(event) {
            if (!gameActive) return;
            switch(event.key) {
                case KEYS.LEFT:
                    movePiece(-1);
                    break;
                case KEYS.RIGHT:
                    movePiece(1);
                    break;
                case KEYS.DOWN:
                    dropPiece();
                    break;
                case KEYS.UP:
                    rotatePiece();
                    break;
                case KEYS.SPACE:
                    while (!checkCollision()) {
                        clearPiece();
                        currentPiece.position.y++;
                    }
                    currentPiece.position.y--;
                    mergePiece();
                    clearLines();
                    spawnPiece();
                    draw();
                    break;
            }
        }

        startButton.addEventListener('click', startGame);
        restartButton.addEventListener('click', startGame);
        document.addEventListener('keydown', handleKeyDown);

        createGrid();
    </script>
</body>
</html>
